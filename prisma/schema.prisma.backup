generator client {
provider = "prisma-client-js"
}

datasource db {
provider = "postgresql"
url = env("DATABASE_URL")
}

model User {
id String @id @default(cuid())
email String @unique
password String?
name String?
role UserRole @default(CUSTOMER)
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt

orders Order[]
wishlist WishlistItem[]
addresses Address[]
reviews Review[]
sessions Session[]
}

model Product {
id String @id @default(cuid())
sku String @unique
name String
slug String @unique
description String @db.Text
shortDescription String
category Category @relation(fields: [categoryId], references: [id])
categoryId String
brand String
price Decimal @db.Decimal(10,2)
salePrice Decimal? @db.Decimal(10,2)
inventory Int @default(0)
images ProductImage[]
specifications Specification[]
reviews Review[]
tags String[]
isFeatured Boolean @default(false)
isNew Boolean @default(false)
rating Float @default(0)
reviewCount Int @default(0)
deliveryEstimate String
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt

@@index([slug])
@@index([categoryId])
@@index([brand])
}

model Category {
id String @id @default(cuid())
name String @unique
slug String @unique
description String?
icon String?
parentId String?
parent Category? @relation("CategoryToCategory", fields: [parentId], references: [id])
children Category[] @relation("CategoryToCategory")
products Product[]
order Int @default(0)

@@index([slug])
@@index([parentId])
}

model Order {
id String @id @default(cuid())
orderNumber String @unique
user User @relation(fields: [userId], references: [id])
userId String
items OrderItem[]
status OrderStatus @default(PENDING)
subtotal Decimal @db.Decimal(10,2)
tax Decimal @db.Decimal(10,2)
shippingCost Decimal @db.Decimal(10,2)
total Decimal @db.Decimal(10,2)
shippingAddress Address @relation("ShippingAddress")
billingAddress Address? @relation("BillingAddress")
paymentMethod String
paymentStatus PaymentStatus @default(PENDING)
stripePaymentId String?
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt

@@index([orderNumber])
@@index([userId])
@@index([status])
}

model WishlistItem {
id String @id @default(cuid())
user User @relation(fields: [userId], references: [id])
userId String
product Product @relation(fields: [productId], references: [id])
productId String
createdAt DateTime @default(now())

@@unique([userId, productId])
}

enum UserRole {
CUSTOMER
ADMIN
MANAGER
}

enum OrderStatus {
PENDING
PROCESSING
SHIPPED
DELIVERED
CANCELLED
}

enum PaymentStatus {
PENDING
PAID
FAILED
REFUNDED
}